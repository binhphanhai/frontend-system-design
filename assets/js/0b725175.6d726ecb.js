"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2296],{6247:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"google-docs","title":"Google Docs System Design: Real-Time Collaborative Document Editing","description":"System design interview question: Design a collaborative document editor that allows users to collaborate on a document in real-time.","source":"@site/docs/11-google-docs.md","sourceDirName":".","slug":"/google-docs","permalink":"/frontend-system-design/docs/google-docs","draft":false,"unlisted":false,"editUrl":"https://github.com/binhphanhai/frontend-system-design/tree/main/Summarize/docs/11-google-docs.md","tags":[],"version":"current","sidebarPosition":11,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Rich Text Editor System Design","permalink":"/frontend-system-design/docs/rich-text-editor"},"next":{"title":"Email Client System Design (e.g. Microsoft Outlook)","permalink":"/frontend-system-design/docs/email-client"}}');var s=i(4848),t=i(8453);const l={},o="Google Docs System Design: Real-Time Collaborative Document Editing",d={},a=[{value:"Overview",id:"overview",level:2},{value:"1. Requirements Exploration",id:"1-requirements-exploration",level:2},{value:"Functional Requirements",id:"functional-requirements",level:3},{value:"Non-Functional Requirements",id:"non-functional-requirements",level:3},{value:"2. Collaboration Challenges &amp; Background",id:"2-collaboration-challenges--background",level:2},{value:"Groupware Systems",id:"groupware-systems",level:3},{value:"3. Rendering and Editing Rich Text",id:"3-rendering-and-editing-rich-text",level:2},{value:"4. Network Architecture &amp; Communication Model",id:"4-network-architecture--communication-model",level:2},{value:"Client-Server Model",id:"client-server-model",level:3},{value:"Peer-to-Peer Model",id:"peer-to-peer-model",level:3},{value:"5. Request Payloads: Full Document vs. Deltas",id:"5-request-payloads-full-document-vs-deltas",level:2},{value:"6. Concurrency Control &amp; Conflict Resolution",id:"6-concurrency-control--conflict-resolution",level:2},{value:"Concurrency Models",id:"concurrency-models",level:3},{value:"Conflict Resolution Approaches",id:"conflict-resolution-approaches",level:3},{value:"Example: Alice &amp; Bob Edit",id:"example-alice--bob-edit",level:4},{value:"OT vs. CRDTs",id:"ot-vs-crdts",level:4},{value:"Conflict Resolution Properties",id:"conflict-resolution-properties",level:4},{value:"7. Collaboration Protocol &amp; Update Scheduling",id:"7-collaboration-protocol--update-scheduling",level:2},{value:"Fast vs. Slow Connections",id:"fast-vs-slow-connections",level:4},{value:"Collaboration Example",id:"collaboration-example",level:4},{value:"Operation Granularity",id:"operation-granularity",level:4},{value:"8. Data Model",id:"8-data-model",level:2},{value:"Example Revision Log",id:"example-revision-log",level:4},{value:"Joining a Session",id:"joining-a-session",level:4},{value:"Operational Transformations on Document Trees",id:"operational-transformations-on-document-trees",level:4},{value:"9. API &amp; Interface Definition",id:"9-api--interface-definition",level:2},{value:"Initialization API",id:"initialization-api",level:3},{value:"Update/Save API (WebSocket)",id:"updatesave-api-websocket",level:3},{value:"Update Acknowledgement",id:"update-acknowledgement",level:3},{value:"Peer Update",id:"peer-update",level:3},{value:"On Reconnect",id:"on-reconnect",level:3},{value:"10. Optimizations &amp; Deep Dive",id:"10-optimizations--deep-dive",level:2},{value:"History &amp; Versioning",id:"history--versioning",level:3},{value:"Example Version Log",id:"example-version-log",level:4},{value:"Undo/Redo",id:"undoredo",level:3},{value:"Example Undo Log",id:"example-undo-log",level:4},{value:"Reliability",id:"reliability",level:3},{value:"Offline Editing",id:"offline-editing",level:3},{value:"Document Formats",id:"document-formats",level:3},{value:"11. Transport Mechanisms",id:"11-transport-mechanisms",level:2},{value:"12. Architecture / High-Level Design (RADIO Framework)",id:"12-architecture--high-level-design-radio-framework",level:2},{value:"13. References &amp; Further Reading",id:"13-references--further-reading",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"google-docs-system-design-real-time-collaborative-document-editing",children:"Google Docs System Design: Real-Time Collaborative Document Editing"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"System design interview question: Design a collaborative document editor that allows users to collaborate on a document in real-time."})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"Google Docs and similar collaborative editors (e.g., Notion, Quip, Etherpad) enable multiple users to edit documents simultaneously, with changes reflected in real-time. This document provides a deep, technical dive into the architecture, data model, protocols, and conflict resolution strategies that power such systems, focusing on the collaboration aspects rather than the text editing core. It covers all major and minor aspects, trade-offs, and real-world considerations."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"1-requirements-exploration",children:"1. Requirements Exploration"}),"\n",(0,s.jsx)(n.h3,{id:"functional-requirements",children:"Functional Requirements"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Any participant can edit/view the document"}),"\n",(0,s.jsx)(n.li,{children:"Updates by peers are reflected automatically and in real-time"}),"\n",(0,s.jsx)(n.li,{children:"Conflicts are resolved if participants edit the same part"}),"\n",(0,s.jsx)(n.li,{children:"All participants eventually see the same document revision (eventual consistency)"}),"\n",(0,s.jsx)(n.li,{children:"(Optional) Offline usage"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"non-functional-requirements",children:"Non-Functional Requirements"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Real-time updates (sub-500ms latency)"}),"\n",(0,s.jsxs)(n.li,{children:["Support up to 100 concurrent editors (",(0,s.jsx)(n.a,{href:"https://support.google.com/docs/answer/2494822",children:"Google's documented limit"}),")"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"2-collaboration-challenges--background",children:"2. Collaboration Challenges & Background"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Responsiveness:"})," Local edits must appear instantly (zero-latency UX)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Real-time updates:"})," Peer edits must propagate quickly"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Conflict-prone:"})," Simultaneous edits to the same region are common"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Distributed:"})," Users are globally distributed, each on their own device"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Ad hoc:"})," Participants can join/leave at any time"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Unpredictable:"})," Editing patterns are not pre-scripted"]}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Main challenge:"})," How to correctly apply remote edits that were made on different document versions, possibly conflicting with local changes?"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"groupware-systems",children:"Groupware Systems"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:'Collaborative editors are a type of "groupware system"'}),"\n",(0,s.jsx)(n.li,{children:"Each browser tab/session is treated as a separate participant"}),"\n",(0,s.jsx)(n.li,{children:"Complexity arises from network latency and the need for instant local feedback"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"3-rendering-and-editing-rich-text",children:"3. Rendering and Editing Rich Text"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Most web-based editors use ",(0,s.jsx)(n.code,{children:"contenteditable"})," with a custom document model and event handling"]}),"\n",(0,s.jsxs)(n.li,{children:["Google Docs is moving towards a ",(0,s.jsx)(n.code,{children:"<canvas>"}),"-based renderer for performance and consistency (",(0,s.jsx)(n.a,{href:"https://workspaceupdates.googleblog.com/2021/05/Google-Docs-Canvas-Based-Rendering-Update.html",children:"announcement"}),")"]}),"\n",(0,s.jsx)(n.li,{children:"The document model is typically a tree (root \u2192 paragraphs/headings \u2192 text nodes)"}),"\n",(0,s.jsxs)(n.li,{children:["See the ",(0,s.jsx)(n.a,{href:"/frontend-system-design/docs/rich-text-editor",children:"Rich Text Editor system design article"})," for a deep dive on the editing core"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"4-network-architecture--communication-model",children:"4. Network Architecture & Communication Model"}),"\n",(0,s.jsx)(n.h3,{id:"client-server-model",children:"Client-Server Model"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://www.gfecdn.net/img/questions/collaborative-editor-google-docs/client-server-architecture.png",alt:"Client-server architecture"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Central server holds the source of truth"}),"\n",(0,s.jsx)(n.li,{children:"All clients communicate only with the server"}),"\n",(0,s.jsx)(n.li,{children:"New participants fetch the latest document from the server"}),"\n",(0,s.jsx)(n.li,{children:"Robust, scalable, and enables database persistence"}),"\n",(0,s.jsx)(n.li,{children:"Server can broadcast updates, handle late joiners, and persist history"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"peer-to-peer-model",children:"Peer-to-Peer Model"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://www.gfecdn.net/img/questions/collaborative-editor-google-docs/peer-to-peer-architecture.png",alt:"Peer-to-peer architecture"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Peers communicate directly"}),"\n",(0,s.jsx)(n.li,{children:"Harder to synchronize, not ideal for document editing"}),"\n",(0,s.jsx)(n.li,{children:"Security, consensus, and persistence are more complex"}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Client-server is preferred for collaborative document editing."})}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"5-request-payloads-full-document-vs-deltas",children:"5. Request Payloads: Full Document vs. Deltas"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Full document:"})," Easy to reason about, but not scalable for large docs; inefficient for real-time"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Deltas (operations):"})," Only send the changes (insert, delete, format, etc.)","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Small, efficient, but require version tracking and conflict resolution"}),"\n",(0,s.jsx)(n.li,{children:"Each operation includes type, position, and payload (e.g., insert, delete, format)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"6-concurrency-control--conflict-resolution",children:"6. Concurrency Control & Conflict Resolution"}),"\n",(0,s.jsx)(n.h3,{id:"concurrency-models",children:"Concurrency Models"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Pessimistic:"})," Locking, floor control (token-based, chair-controlled)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Optimistic:"})," Local edits applied instantly, conflicts resolved after the fact"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Version-detection:"})," Each update includes the document revision it was based on; server transforms or rejects as needed"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"conflict-resolution-approaches",children:"Conflict Resolution Approaches"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Operational Transformations (OT):"})," Transform operations to preserve intent and causality"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Conflict-free Replicated Data Types (CRDTs):"})," Use data structures that guarantee convergence regardless of operation order"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"example-alice--bob-edit",children:"Example: Alice & Bob Edit"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://www.gfecdn.net/img/questions/collaborative-editor-google-docs/alice-bob-without-ot.png",alt:"Alice and Bob network diagram without operational transformations"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Without OT, order of operations can lead to divergent states"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://www.gfecdn.net/img/questions/collaborative-editor-google-docs/alice-bob-with-ot.png",alt:"Alice and Bob network diagram with operational transformations"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"With OT, operations are transformed so all replicas converge"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"ot-vs-crdts",children:"OT vs. CRDTs"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"OT:"})," Mature, used by Google Docs, excels for text editing; requires transformation functions and revision tracking"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"CRDTs:"})," Modern, used by Figma, more general but complex for text; commutative/associative operations, metadata overhead"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"conflict-resolution-properties",children:"Conflict Resolution Properties"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Convergence:"})," All replicas eventually reach the same state"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Causality preservation:"})," Order of operations respects dependencies"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Intention preservation:"})," User intent is maintained after merging"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"7-collaboration-protocol--update-scheduling",children:"7. Collaboration Protocol & Update Scheduling"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Local updates buffer:"})," Edits are batched locally"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Sent updates buffer:"})," Tracks in-flight operations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Only one in-flight request per client:"})," Ensures ordered delivery"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Server broadcasts updates to all clients"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Clients transform incoming operations as needed"})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Revision numbers:"})," Used to track document state and synchronize"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"fast-vs-slow-connections",children:"Fast vs. Slow Connections"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://www.gfecdn.net/img/questions/collaborative-editor-google-docs/fast-slow-connection-requests.png",alt:"Fast vs slow connection for edit requests"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Fast clients send more frequent, smaller requests"}),"\n",(0,s.jsx)(n.li,{children:"Slow clients send less frequent, larger requests"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"collaboration-example",children:"Collaboration Example"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.img,{src:"https://www.gfecdn.net/img/questions/collaborative-editor-google-docs/collaboration-part-1.png",alt:"Collaboration part 1"}),"\r\n",(0,s.jsx)(n.img,{src:"https://www.gfecdn.net/img/questions/collaborative-editor-google-docs/collaboration-part-2.png",alt:"Collaboration part 2"})]}),"\n",(0,s.jsx)(n.h4,{id:"operation-granularity",children:"Operation Granularity"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Coalesce continuous typing/deletion into single operations"}),"\n",(0,s.jsx)(n.li,{children:"Each request can contain multiple operations"}),"\n",(0,s.jsx)(n.li,{children:"Operations are intention-based (insert, delete, format, etc.)"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"8-data-model",children:"8. Data Model"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Document state:"})," Tree structure (root \u2192 paragraphs/headings \u2192 text nodes)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Revision log:"})," Append-only log of operations (insert, delete, format, etc.)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Clients:"})," Track initial state, local/sent/received operations, and current revision"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Server:"})," Tracks pending updates, revision log, and current document state"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"example-revision-log",children:"Example Revision Log"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Rev no."}),(0,s.jsx)(n.th,{children:"User"}),(0,s.jsx)(n.th,{children:"Operations"}),(0,s.jsx)(n.th,{children:"Timestamp"}),(0,s.jsx)(n.th,{children:"Document state"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"0"}),(0,s.jsx)(n.td,{children:"N/A"}),(0,s.jsx)(n.td,{children:"N/A"}),(0,s.jsx)(n.td,{children:"2024-08-03 10:00"}),(0,s.jsx)(n.td,{children:"<EMPTY>"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"1"}),(0,s.jsx)(n.td,{children:"Charlie"}),(0,s.jsx)(n.td,{children:'INS "Hello" @0'}),(0,s.jsx)(n.td,{children:"2024-08-03 10:05"}),(0,s.jsx)(n.td,{children:'"Hello"'})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"2"}),(0,s.jsx)(n.td,{children:"Alice"}),(0,s.jsx)(n.td,{children:'INS " world" @5'}),(0,s.jsx)(n.td,{children:"2024-08-03 10:10"}),(0,s.jsx)(n.td,{children:'"Hello world"'})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"3"}),(0,s.jsx)(n.td,{children:"Bob"}),(0,s.jsx)(n.td,{children:'INS "!" @11'}),(0,s.jsx)(n.td,{children:"2024-08-03 10:15"}),(0,s.jsx)(n.td,{children:'"Hello world!"'})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"joining-a-session",children:"Joining a Session"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://www.gfecdn.net/img/questions/collaborative-editor-google-docs/join-session.png",alt:"User joins a collaborative editing session"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"New users are initialized with the latest document state"}),"\n",(0,s.jsx)(n.li,{children:"Local/sent/received operation buffers are empty on join"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"operational-transformations-on-document-trees",children:"Operational Transformations on Document Trees"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"OTs can be applied to both character lists and tree structures (e.g., paragraphs, headings)"}),"\n",(0,s.jsx)(n.li,{children:"Conflicts arise when the same node is modified; OTs resolve these at the list level"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"9-api--interface-definition",children:"9. API & Interface Definition"}),"\n",(0,s.jsx)(n.h3,{id:"initialization-api",children:"Initialization API"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n  "revision": 145,\r\n  "document": "..." // Rich text editor format\r\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"updatesave-api-websocket",children:"Update/Save API (WebSocket)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n  "type": "UPDATE",\r\n  "requestId": 2,\r\n  "revision": 146,\r\n  "isUndo": false,\r\n  "operations": [\r\n    { "type": "INSERT", "nodeId": 24, "payload": { "characters": "Hello", "index": 4 } },\r\n    { "type": "INSERT", "nodeId": 25, "payload": { "characters": "Bye", "index": 2 } }\r\n  ]\r\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"update-acknowledgement",children:"Update Acknowledgement"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n  "type": "ACK",\r\n  "requestIdAcknowledged": 2,\r\n  "requestId": 3,\r\n  "revision": 147\r\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"peer-update",children:"Peer Update"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n  "type": "PEER_UPDATE",\r\n  "revision": 148,\r\n  "userId": 6543,\r\n  "operations": [ ... ]\r\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"on-reconnect",children:"On Reconnect"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n  "type": "SYNC",\r\n  "revisions": [ ... ]\r\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"10-optimizations--deep-dive",children:"10. Optimizations & Deep Dive"}),"\n",(0,s.jsx)(n.h3,{id:"history--versioning",children:"History & Versioning"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Store as a log of operations (event sourcing)"}),"\n",(0,s.jsx)(n.li,{children:"Enables time travel/version history"}),"\n",(0,s.jsx)(n.li,{children:'Group revisions into user-facing "versions"'}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"example-version-log",children:"Example Version Log"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Version"}),(0,s.jsx)(n.th,{children:"Time"}),(0,s.jsx)(n.th,{children:"Last edited by"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"1"}),(0,s.jsx)(n.td,{children:"2024-08-03 10:15"}),(0,s.jsx)(n.td,{children:"Charlie, Bob, Alice"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"2"}),(0,s.jsx)(n.td,{children:"2024-08-05 09:10"}),(0,s.jsx)(n.td,{children:"Donald, Erin"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"undoredo",children:"Undo/Redo"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Per-user undo/redo (not global)"}),"\n",(0,s.jsx)(n.li,{children:"Undo is implemented by appending the negation of the previous operation"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"isUndo"})," flag differentiates undo operations"]}),"\n",(0,s.jsx)(n.li,{children:"Undo/redo granularity is at the intention level"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"example-undo-log",children:"Example Undo Log"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Rev no."}),(0,s.jsx)(n.th,{children:"User"}),(0,s.jsx)(n.th,{children:"Operation"}),(0,s.jsx)(n.th,{children:"Is undo"}),(0,s.jsx)(n.th,{children:"Document"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"4"}),(0,s.jsx)(n.td,{children:"Donald"}),(0,s.jsx)(n.td,{children:'INS " Goodbye" @12'}),(0,s.jsx)(n.td,{children:"False"}),(0,s.jsx)(n.td,{children:'"Hello world! Goodbye"'})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"5"}),(0,s.jsx)(n.td,{children:"Erin"}),(0,s.jsx)(n.td,{children:'INS " earth" @20'}),(0,s.jsx)(n.td,{children:"False"}),(0,s.jsx)(n.td,{children:'"Hello world! Goodbye earth"'})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"6"}),(0,s.jsx)(n.td,{children:"Erin"}),(0,s.jsx)(n.td,{children:'INS "..." @26'}),(0,s.jsx)(n.td,{children:"False"}),(0,s.jsx)(n.td,{children:'"Hello world! Goodbye earth\u2026"'})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"7"}),(0,s.jsx)(n.td,{children:"Erin"}),(0,s.jsx)(n.td,{children:"DEL 3 @29"}),(0,s.jsx)(n.td,{children:"True"}),(0,s.jsx)(n.td,{children:'"Hello world! Goodbye earth"'})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"8"}),(0,s.jsx)(n.td,{children:"Erin"}),(0,s.jsx)(n.td,{children:"DEL 6 @26"}),(0,s.jsx)(n.td,{children:"True"}),(0,s.jsx)(n.td,{children:'"Hello world! Goodbye"'})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"reliability",children:"Reliability"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Clients track their own revision number and include it in requests"}),"\n",(0,s.jsx)(n.li,{children:"Server can send missing updates on reconnect"}),"\n",(0,s.jsx)(n.li,{children:"WebSockets + application logic (e.g., Socket.io) for ordered, reliable delivery"}),"\n",(0,s.jsx)(n.li,{children:"Each update operation has a unique ID for deduplication"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"offline-editing",children:"Offline Editing"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Edits are buffered locally when offline"}),"\n",(0,s.jsx)(n.li,{children:"On reconnect, local updates are sent and missing updates are fetched"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"document-formats",children:"Document Formats"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Internal model is tree-based; import/export to ",(0,s.jsx)(n.code,{children:".docx"}),", ",(0,s.jsx)(n.code,{children:".odt"}),", etc."]}),"\n",(0,s.jsxs)(n.li,{children:["Example: ",(0,s.jsx)(n.code,{children:".odt"})," is a ZIP archive of XML files (content, styles, meta, settings, manifest)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"content.xml"}),": Document content; ",(0,s.jsx)(n.code,{children:"styles.xml"}),": Styles; ",(0,s.jsx)(n.code,{children:"meta.xml"}),": Metadata; ",(0,s.jsx)(n.code,{children:"settings.xml"}),": Settings; ",(0,s.jsx)(n.code,{children:"manifest.xml"}),": File manifest"]}),"\n",(0,s.jsx)(n.li,{children:"Images and embedded objects are stored as separate files in the archive"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"11-transport-mechanisms",children:"11. Transport Mechanisms"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"WebSockets:"})," Full-duplex, low-latency, bidirectional; best for collaborative editing"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Server-Sent Events (SSE):"})," Unidirectional (server-to-client); can be combined with HTTP for client-to-server"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Long polling:"})," Inefficient, higher latency, not recommended for modern apps"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Reliability & Ordering:"})," Application logic (e.g., Socket.io) ensures in-order delivery, retries, and reconnections"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"12-architecture--high-level-design-radio-framework",children:"12. Architecture / High-Level Design (RADIO Framework)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Requirements:"})," Real-time, multi-user, conflict-resilient, scalable, reliable"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Architecture:"})," Client-server, central revision log, WebSockets for transport"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Data Model:"})," Tree-based document, append-only revision log, operation buffers"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Interfaces:"})," Initialization, update, acknowledgement, peer update, sync on reconnect"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Optimizations:"})," Coalescing, batching, intention-based granularity, per-user undo/redo, version history"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"13-references--further-reading",children:"13. References & Further Reading"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://dl.acm.org/doi/pdf/10.1145/67544.66963",children:"Concurrency Control in Groupware Systems (ACM)"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://dl.acm.org/doi/pdf/10.1145/215585.215706",children:"High-Latency, Low-Bandwidth Windowing in the Jupiter Collaboration System (ACM)"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://drive.googleblog.com/2010/09/whats-different-about-new-google-docs_22.html",children:"What\u2019s different about the new Google Docs: Conflict resolution"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://medium.com/coinmonks/operational-transformations-as-an-algorithm-for-automatic-conflict-resolution-3bf8920ea447",children:"Operational Transformations as an algorithm for automatic conflict resolution"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://operational-transformation.github.io/",children:"Visualization of OT with a central server"})}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.p,{children:"This document provides a comprehensive, technical overview of the design and implementation of a real-time collaborative document editor like Google Docs. It covers architectural decisions, data modeling, update flows, conflict resolution, reliability, and real-world trade-offs, serving as a reference for advanced system design interviews and real-world implementations."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>o});var r=i(6540);const s={},t=r.createContext(s);function l(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);