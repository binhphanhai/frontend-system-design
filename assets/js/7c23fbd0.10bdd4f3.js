"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[4928],{7317:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"frontend-system-design/rich-text-editor","title":"Rich Text Editor System Design","description":"System design interview question: Design an extensible rich text editor component that allows users to create and edit text with various formatting options.","source":"@site/docs/frontend-system-design/10-rich-text-editor.md","sourceDirName":"frontend-system-design","slug":"/frontend-system-design/rich-text-editor","permalink":"/frontend-system-design/docs/frontend-system-design/rich-text-editor","draft":false,"unlisted":false,"editUrl":"https://github.com/binhphanhai/frontend-system-design/tree/main/Summarize/docs/frontend-system-design/10-rich-text-editor.md","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{},"sidebar":"frontendSystemDesignSidebar","previous":{"title":"Pinterest System Design: Masonry Layout and Feed","permalink":"/frontend-system-design/docs/frontend-system-design/pinterest"},"next":{"title":"Google Docs System Design: Real-Time Collaborative Document Editing","permalink":"/frontend-system-design/docs/frontend-system-design/google-docs"}}');var r=i(4848),t=i(8453);const l={},d="Rich Text Editor System Design",o={},a=[{value:"Overview",id:"overview",level:2},{value:"1. Real-World Examples",id:"1-real-world-examples",level:2},{value:"2. Requirements Exploration",id:"2-requirements-exploration",level:2},{value:"Functional Requirements",id:"functional-requirements",level:3},{value:"Non-Functional Requirements",id:"non-functional-requirements",level:3},{value:"3. Rendering Approaches",id:"3-rendering-approaches",level:2},{value:"Comparison",id:"comparison",level:3},{value:"4. Architecture / High-Level Design",id:"4-architecture--high-level-design",level:2},{value:"Core Components",id:"core-components",level:3},{value:"5. Data Model",id:"5-data-model",level:2},{value:"Core Entities",id:"core-entities",level:3},{value:"Example (TypeScript)",id:"example-typescript",level:4},{value:"Content Tree Example",id:"content-tree-example",level:4},{value:"NodeMap with Linked List Pointers",id:"nodemap-with-linked-list-pointers",level:4},{value:"Formatting Example",id:"formatting-example",level:4},{value:"6. State Management &amp; Update Flow",id:"6-state-management--update-flow",level:2},{value:"Update Loop in Detail",id:"update-loop-in-detail",level:4},{value:"7. API &amp; Extensibility",id:"7-api--extensibility",level:2},{value:"Editor APIs",id:"editor-apis",level:3},{value:"Node APIs",id:"node-apis",level:3},{value:"8. Plugins, Listeners, and Transforms",id:"8-plugins-listeners-and-transforms",level:2},{value:"Example: Bold Command",id:"example-bold-command",level:4},{value:"Example: Transform",id:"example-transform",level:4},{value:"9. Serialization &amp; Undo/Redo",id:"9-serialization--undoredo",level:2},{value:"10. Keyboard Shortcuts &amp; Accessibility",id:"10-keyboard-shortcuts--accessibility",level:2},{value:"11. Theming &amp; Customization",id:"11-theming--customization",level:2},{value:"12. Custom Nodes &amp; Extensibility",id:"12-custom-nodes--extensibility",level:2},{value:"Example: ColoredTextNode",id:"example-coloredtextnode",level:4},{value:"13. Performance Optimizations",id:"13-performance-optimizations",level:2},{value:"14. Internationalization (i18n)",id:"14-internationalization-i18n",level:2},{value:"15. Real-Time Collaboration (Advanced)",id:"15-real-time-collaboration-advanced",level:2},{value:"16. Deep Dives &amp; Advanced Topics",id:"16-deep-dives--advanced-topics",level:2},{value:"Model and State Design",id:"model-and-state-design",level:3},{value:"Formatting Internals",id:"formatting-internals",level:3},{value:"Selection State",id:"selection-state",level:3},{value:"Reconciliation",id:"reconciliation",level:3},{value:"Undo/Redo Internals",id:"undoredo-internals",level:3},{value:"Plugins, Listeners, and Commands",id:"plugins-listeners-and-commands",level:3},{value:"Serialization &amp; Deserialization",id:"serialization--deserialization",level:3},{value:"Accessibility",id:"accessibility",level:3},{value:"Theming",id:"theming",level:3},{value:"Custom Nodes",id:"custom-nodes",level:3},{value:"Performance",id:"performance",level:3},{value:"Internationalization",id:"internationalization",level:3},{value:"Real-Time Collaboration",id:"real-time-collaboration",level:3},{value:"17. References &amp; Further Reading",id:"17-references--further-reading",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"rich-text-editor-system-design",children:"Rich Text Editor System Design"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"System design interview question: Design an extensible rich text editor component that allows users to create and edit text with various formatting options."})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.p,{children:["Rich text editors (RTEs), or WYSIWYG editors, are complex UI components that allow users to format text visually, supporting features like bold, italics, headings, and more. They are used in products like Gmail, Facebook, Medium, and collaborative tools. This document provides a deep, technical dive into designing a modern, extensible, performant, and accessible rich text editor, using Meta's ",(0,r.jsx)(n.a,{href:"https://lexical.dev/",children:"Lexical"})," as a reference architecture, and covers all major and minor aspects of such a system."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"1-real-world-examples",children:"1. Real-World Examples"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://lexical.dev/",children:"Lexical"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://tiptap.dev/",children:"Tiptap"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"http://slatejs.org/",children:"Slate"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://quilljs.com/",children:"Quill"})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://draftjs.org/",children:"Draft.js"})," (predecessor of Lexical)"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"2-requirements-exploration",children:"2. Requirements Exploration"}),"\n",(0,r.jsx)(n.h3,{id:"functional-requirements",children:"Functional Requirements"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Block formatting:"})," Headings, paragraphs, blockquotes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Inline formatting:"})," Bold, underline, italics"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Media insertion:"})," (Optional) Images, videos, etc."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Keyboard shortcuts:"})," Copy, cut, paste, redo, undo, formatting"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Customizability:"})," Theming, extensibility, custom nodes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Undo/redo:"})," Support for reverting and reapplying changes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Serialization:"})," Save/load content as JSON or HTML"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Collaboration:"})," (Advanced) Real-time multi-user editing"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"non-functional-requirements",children:"Non-Functional Requirements"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Performance:"})," Instant updates, even for large documents"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cross-browser:"})," Consistent experience across browsers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Accessibility:"})," Keyboard navigation, screen reader support, ARIA"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Security:"})," Prevent XSS and unsafe HTML"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Internationalization:"})," RTL, IME support"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"3-rendering-approaches",children:"3. Rendering Approaches"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Approach"}),(0,r.jsx)(n.th,{children:"Rich Formatting"}),(0,r.jsx)(n.th,{children:"Cursors"}),(0,r.jsx)(n.th,{children:"Implementation Effort"}),(0,r.jsx)(n.th,{children:"Cross-browser"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"<textarea>"})}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"Supported"}),(0,r.jsx)(n.td,{children:"N/A"}),(0,r.jsx)(n.td,{children:"Same"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"DOM with fake cursors"}),(0,r.jsx)(n.td,{children:"Supported"}),(0,r.jsx)(n.td,{children:"Custom"}),(0,r.jsx)(n.td,{children:"High"}),(0,r.jsx)(n.td,{children:"Same"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"contenteditable"})}),(0,r.jsx)(n.td,{children:"Supported"}),(0,r.jsx)(n.td,{children:"Supported"}),(0,r.jsx)(n.td,{children:"Moderate"}),(0,r.jsx)(n.td,{children:"Some diffs"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"<canvas>"})}),(0,r.jsx)(n.td,{children:"Custom"}),(0,r.jsx)(n.td,{children:"Custom"}),(0,r.jsx)(n.td,{children:"Very high"}),(0,r.jsx)(n.td,{children:"Same"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"comparison",children:"Comparison"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"<textarea>"})}),": Only plain text, not suitable for rich formatting."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"DOM with fake cursors"}),": Complex, must manually calculate cursor position/height."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"contenteditable"})}),": Best trade-off; supports native editing, cursors, and formatting, but has browser inconsistencies and security concerns (HTML storage)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"<canvas>"})}),": Full control, but must reimplement layout, selection, accessibility, and more. Used by Google Docs for performance and consistency."]}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["Most modern RTEs use ",(0,r.jsx)(n.code,{children:"contenteditable"})," as the foundation, patching its limitations with custom event handling and state management."]})}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"4-architecture--high-level-design",children:"4. Architecture / High-Level Design"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://www.gfecdn.net/img/questions/rich-text-editor/rich-text-editor-architecture.png",alt:"Rich text editor architecture"})}),"\n",(0,r.jsx)(n.h3,{id:"core-components",children:"Core Components"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Editor Core"}),": Handles user events, state updates, and DOM reconciliation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Plugins"}),": Extend functionality (e.g., rich formatting, collaboration)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Node-based Content Model"}),": Tree structure for blocks and inlines"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Toolbar"}),": UI for formatting actions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Listeners & Transforms"}),": Hooks for reacting to state changes and transforming content"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Headless Mode"}),": Editor logic can run without a UI, useful for testing and server-side manipulation"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"5-data-model",children:"5. Data Model"}),"\n",(0,r.jsx)(n.h3,{id:"core-entities",children:"Core Entities"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Editor"}),": Manages state, selection, plugins, and DOM reference"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"EditorState"}),": Immutable snapshot of content and selection"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"EditorNode"}),": Base class for all content nodes","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ElementNode"}),": Can have children (e.g., paragraphs, headings)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"TextNode"}),": Leaf node, holds text and formatting"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Selection"}),": Anchor/focus nodes and offsets, direction"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"example-typescript",children:"Example (TypeScript)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"interface Editor {\r\n  rootElement: HTMLElement | null;\r\n  editorState: EditorState;\r\n  pendingEditorState: EditorState | null;\r\n}\r\n\r\ninterface EditorState {\r\n  nodes: EditorNodeMap;\r\n  rootNodeKey: NodeKey;\r\n  selection: EditorSelection | null;\r\n}\r\n\r\ntype NodeKey = string;\r\ntype EditorNodeMap = Record<NodeKey, EditorNode>;\r\n\r\ninterface EditorNode {\r\n  parent: NodeKey | null;\r\n  prev: NodeKey | null;\r\n  next: NodeKey | null;\r\n}\r\n\r\ninterface ElementNode extends EditorNode {\r\n  type: 'element';\r\n  firstChild: NodeKey | null;\r\n  lastChild: NodeKey | null;\r\n}\r\n\r\ninterface TextNode extends EditorNode {\r\n  type: 'text';\r\n  text: string;\r\n  format?: string[];\r\n}\r\n\r\ninterface EditorSelection {\r\n  anchorNode: EditorNode | null;\r\n  anchorOffset: number;\r\n  focusNode: EditorNode | null;\r\n  focusOffset: number;\r\n  type: 'caret' | 'range';\r\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"content-tree-example",children:"Content Tree Example"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://www.gfecdn.net/img/questions/rich-text-editor/rich-text-editor-tree.png",alt:"Rich text editor tree"})}),"\n",(0,r.jsx)(n.h4,{id:"nodemap-with-linked-list-pointers",children:"NodeMap with Linked List Pointers"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://www.gfecdn.net/img/questions/rich-text-editor/rich-text-editor-linked-list.png",alt:"Rich text editor linked list"})}),"\n",(0,r.jsx)(n.h4,{id:"formatting-example",children:"Formatting Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"<TextNode text=\"Tarzan \" format={['bold']} />\r\n<TextNode text=\"and\" format={['bold', 'underline']} />\r\n<TextNode text=\" Jane\" format={['underline']} />\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"6-state-management--update-flow",children:"6. State Management & Update Flow"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"User event"})," (input, keypress, toolbar click)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Command dispatched"})," (e.g., FORMAT_TEXT)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Clone state"})," (shallow copy of NodeMap)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Modify state"})," (update nodes, mark dirty)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Transforms"})," (run on dirty nodes)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Reconciliation"})," (diff old/new state, update DOM minimally)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Listeners"})," (notify plugins/UI)"]}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Lexical's reconciliation is similar to React's virtual DOM diffing, but is framework-agnostic."}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"update-loop-in-detail",children:"Update Loop in Detail"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Clone state:"})," Editor makes a shallow clone of the content state (NodeMap)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Process updates:"})," Callback modifies nodes, marks dirty, and can queue further updates."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Process transforms:"})," All registered transforms for dirty nodes are called."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Reconciliation:"})," Dirty nodes are diffed and DOM is updated minimally."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Listeners:"})," All registered listeners are called after update."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"7-api--extensibility",children:"7. API & Extensibility"}),"\n",(0,r.jsx)(n.h3,{id:"editor-apis",children:"Editor APIs"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"editor.update(fn)"})," \u2013 Update state via callback"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"editor.setEditorState(state)"})," \u2013 Replace state"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"editor.getEditorState()"})," / ",(0,r.jsx)(n.code,{children:"editor.getEditorStateSerialized()"})," \u2013 Export state"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"editor.parseEditorState(serialized)"})," \u2013 Import state"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"editor.dispatchCommand(command, payload)"})," \u2013 Dispatch command"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"editor.registerCommand(command, callback, priority)"})," \u2013 Listen for commands"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"editor.registerUpdateListener(callback)"})," \u2013 Listen for updates"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"editor.registerNodeTransform(nodeType, callback)"})," \u2013 Listen for node changes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"editor.getNodeByKey(key)"})," \u2013 Get node by key"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"editor.getElementByKey(key)"})," \u2013 Get DOM element for node"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"node-apis",children:"Node APIs"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"getParent()"}),", ",(0,r.jsx)(n.code,{children:"getNextSibling()"}),", ",(0,r.jsx)(n.code,{children:"insertAfter()"}),", ",(0,r.jsx)(n.code,{children:"isSelected()"}),", ",(0,r.jsx)(n.code,{children:"getTextContent()"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ElementNode"}),": ",(0,r.jsx)(n.code,{children:"getChildren()"}),", ",(0,r.jsx)(n.code,{children:"getFirstChild()"}),", ",(0,r.jsx)(n.code,{children:"getLastChild()"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"TextNode"}),": ",(0,r.jsx)(n.code,{children:"setTextContent()"}),", ",(0,r.jsx)(n.code,{children:"setFormat()"}),", ",(0,r.jsx)(n.code,{children:"getFormat()"})]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"8-plugins-listeners-and-transforms",children:"8. Plugins, Listeners, and Transforms"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Plugins"}),": Combine commands, transforms, and custom nodes to add features (e.g., rich formatting, collaboration)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Listeners"}),": Register callbacks for updates or specific commands"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Transforms"}),": Run on dirty nodes after updates, before reconciliation (e.g., auto-linking, hashtag detection)"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"example-bold-command",children:"Example: Bold Command"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"editor.registerCommand('FORMAT_BOLD_COMMAND', (payload) => {\r\n  // Custom code to handle bold formatting\r\n  return true; // Stop propagation\r\n});\n"})}),"\n",(0,r.jsx)(n.h4,{id:"example-transform",children:"Example: Transform"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"editor.registerNodeTransform(TextNode, (textNode) => {\r\n  if (textNode.getTextContent().includes('congratulations')) {\r\n    textNode.setFormat('bold');\r\n  }\r\n});\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"9-serialization--undoredo",children:"9. Serialization & Undo/Redo"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Serialization"}),": Each node implements ",(0,r.jsx)(n.code,{children:"exportJSON()"})," and ",(0,r.jsx)(n.code,{children:"importJSON()"})," for persistence and copy/paste."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Undo/Redo"}),": Two-stack model (undo/redo), with immutable EditorStates and structural sharing for efficiency."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Granularity"}),": Lexical coalesces continuous typing into single undo actions for usability and performance."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Structural sharing"}),": Only changed nodes are cloned, others are shared for memory efficiency."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"10-keyboard-shortcuts--accessibility",children:"10. Keyboard Shortcuts & Accessibility"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Keyboard shortcuts"}),": Handled via ",(0,r.jsx)(n.code,{children:"beforeinput"})," and ",(0,r.jsx)(n.code,{children:"keydown"})," events, mapped to normalized commands (e.g., FORMAT_BOLD_COMMAND)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Accessibility"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["ARIA roles and properties (e.g., ",(0,r.jsx)(n.code,{children:'role="textbox"'}),", ",(0,r.jsx)(n.code,{children:'role="toolbar"'}),")"]}),"\n",(0,r.jsx)(n.li,{children:"Logical tab order"}),"\n",(0,r.jsx)(n.li,{children:"Screen reader support"}),"\n",(0,r.jsx)(n.li,{children:"Visible focus indicators"}),"\n",(0,r.jsx)(n.li,{children:"Semantic HTML for content"}),"\n",(0,r.jsx)(n.li,{children:"Support for speech-to-text (e.g., Dragon NaturallySpeaking)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"11-theming--customization",children:"11. Theming & Customization"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"CSS"}),": Style output using standard CSS or scoped selectors"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Theme object"}),": Map node types to CSS classes"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const theme = {\r\n  heading: 'editor-heading',\r\n  paragraph: 'editor-paragraph',\r\n  text: 'editor-text',\r\n};\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"12-custom-nodes--extensibility",children:"12. Custom Nodes & Extensibility"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Extend base nodes to add new features (e.g., colored text, mentions, embeds)"}),"\n",(0,r.jsx)(n.li,{children:"Register custom nodes in the editor's config"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"example-coloredtextnode",children:"Example: ColoredTextNode"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"export class ColoredNode extends TextNode {\r\n  __color: string;\r\n  constructor(text, color, key) {\r\n    super(text, key);\r\n    this.__color = color;\r\n  }\r\n  static getType() { return 'colored'; }\r\n  static clone(node) { return new ColoredNode(node.__text, node.__color, node.__key); }\r\n  createDOM(config) {\r\n    const element = super.createDOM(config);\r\n    element.style.color = this.__color;\r\n    return element;\r\n  }\r\n  updateDOM(prevNode, dom, config) {\r\n    if (prevNode.__color !== this.__color) {\r\n      dom.style.color = this.__color;\r\n    }\r\n    return false;\r\n  }\r\n}\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"13-performance-optimizations",children:"13. Performance Optimizations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Lightweight core"}),": Lexical is ~22kb min+gzip"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Modular plugins"}),": Only load what you need"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Lazy loading"}),": Defer plugin loading until needed"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Efficient updates"}),": Immutable state, batched updates, minimal DOM changes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Efficient reconciliation"}),": Virtual DOM-like diffing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Efficient selection model"}),": Mirrors browser selection, supports anchor/focus, direction, and multi-range"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Batching and coalescing"}),": Group related changes for performance"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"14-internationalization-i18n",children:"14. Internationalization (i18n)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"RTL support"}),": Direction property on nodes, layout adapts for right-to-left languages"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"IME support"}),": Works with input method editors for complex scripts (Chinese, Japanese, Korean)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Locale-aware shortcuts"}),": Customizable keyboard shortcuts for different locales"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"15-real-time-collaboration-advanced",children:"15. Real-Time Collaboration (Advanced)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"CRDT/OT"}),": Use Yjs or similar for conflict-free real-time editing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"WebSockets"}),": For real-time updates"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"LexicalCollaborationPlugin"}),": Integrates Yjs with Lexical"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Conflict resolution"}),": Handles simultaneous edits, merges changes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Undo/redo in collaboration"}),": Can be scoped to user or global"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"16-deep-dives--advanced-topics",children:"16. Deep Dives & Advanced Topics"}),"\n",(0,r.jsx)(n.h3,{id:"model-and-state-design",children:"Model and State Design"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Why not use DOM as state?"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"No built-in undo/redo, hard to store extra fields, DOM is bloated, prone to tampering"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Tree vs. Map+Linked List"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Map+linked list enables O(1) access, efficient cloning, and parent/child/sibling navigation"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"formatting-internals",children:"Formatting Internals"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Nested tags"}),": Many ways to represent formatting in HTML; Lexical uses flat TextNodes with format arrays for simplicity and efficient editing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Format ranges"}),": Alternative is to use start/end indices, but this complicates updates"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"selection-state",children:"Selection State"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Anchor/focus, direction"}),": Mirrors browser selection, supports forward/backward selection"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Selection events"}),": Listens to ",(0,r.jsx)(n.code,{children:"selectionchange"}),", keyboard, and mouse events"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"reconciliation",children:"Reconciliation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"createDOM/updateDOM"}),": Each node implements methods for DOM creation and update"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Diffing"}),": Only dirty nodes are updated, minimizing DOM changes"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"undoredo-internals",children:"Undo/Redo Internals"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Stack-based"}),": Two stacks (undo/redo), pointer to current state"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Structural sharing"}),": Only changed nodes are cloned, others are shared"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Granularity"}),": Coalescing of typing, batching of actions"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"plugins-listeners-and-commands",children:"Plugins, Listeners, and Commands"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Commands"}),": Dispatched for user actions, can be intercepted and handled by plugins"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Listeners"}),": Register for updates, can persist data, update UI, etc."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Transforms"}),": Efficiently update content in response to changes (e.g., auto-linking, hashtag detection)"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"serialization--deserialization",children:"Serialization & Deserialization"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"exportJSON/importJSON"}),": Each node serializes/deserializes itself"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"exportDOM/importDOM"}),": For copy/paste between editors"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Versioning"}),": Serialized state can include version for backward compatibility"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"accessibility",children:"Accessibility"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ARIA roles"}),": ",(0,r.jsx)(n.code,{children:'role="textbox"'}),", ",(0,r.jsx)(n.code,{children:'role="toolbar"'}),", etc."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Screen reader support"}),": Announces formatting, structure, and changes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Keyboard navigation"}),": Logical tab order, shortcuts for formatting and navigation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Visible focus"}),": All interactive elements have visible focus indicators"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Semantic HTML"}),": Use of ",(0,r.jsx)(n.code,{children:"<strong>"}),", ",(0,r.jsx)(n.code,{children:"<em>"}),", ",(0,r.jsx)(n.code,{children:"<ul>"}),", ",(0,r.jsx)(n.code,{children:"<li>"}),", etc."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Speech-to-text"}),": Integration with tools like Dragon NaturallySpeaking"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"theming",children:"Theming"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"CSS"}),": Style output using standard CSS or scoped selectors"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Theme object"}),": Map node types to CSS classes"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"custom-nodes",children:"Custom Nodes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Extendability"}),": Add new node types for custom features (mentions, embeds, etc.)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Registration"}),": Pass custom nodes to editor config"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"performance",children:"Performance"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Immutable state"}),": Enables efficient undo/redo and collaboration"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Batching"}),": Group related changes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Lazy loading"}),": Load plugins/features on demand"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Efficient reconciliation"}),": Only update what changed"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"internationalization",children:"Internationalization"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"RTL/IME"}),": Full support for right-to-left and complex input"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Locale-aware"}),": Customizable for different languages and regions"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"real-time-collaboration",children:"Real-Time Collaboration"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"CRDT/OT"}),": Conflict-free, real-time editing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"WebSockets"}),": Real-time updates"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Undo/redo"}),": Per-user or global"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"17-references--further-reading",children:"17. References & Further Reading"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://lexical.dev/",children:"Lexical Documentation"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.slatejs.org/",children:"Slate.js Docs"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://medium.engineering/why-contenteditable-is-terrible-122d8a40e480",children:"Why ContentEditable is Terrible (Medium)"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.youtube.com/watch?v=EwoS0dIx_OI",children:"Rethinking Rich Text: A Deep Dive Into the Design of Lexical (YouTube)"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://lexical.dev/docs/api/classes/lexical.LexicalNode",children:"Lexical API Docs"})}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.p,{children:"This document provides a comprehensive, technical overview of the design and implementation of a modern, extensible, and performant rich text editor. It covers architectural decisions, data modeling, update flows, extensibility, accessibility, and real-world trade-offs, serving as a reference for advanced system design interviews and real-world implementations."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>d});var s=i(6540);const r={},t=s.createContext(r);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);